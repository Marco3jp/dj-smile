# アイデアノート

## 大枠
- ホストとなるページに iframe で agent extensionの動いているサイトを開く
- Web MIDIをホストページで扱い、DJコントローラーで再生やシーク、再生速度の調整をできるようにする
- ホストページで動画リストや動画メタデータの管理をする
- エージェントページから読み込み状態や再生状態をホストに送信する



### 補足
- agent extension は Tempermonkey で良いかなとは思うが、Chrome拡張にもできるとよいかも
- 初見であればメタデータ（再生時間、投稿者名、タグなど）も送信したい

## 事前の検証
- postMessageを使って動画ページと通信することを考えた
  - こちらの[実装](https://github.com/Marco3jp/instant-internet/tree/dee48b9cc48e3e899463b7f2394935b9c3edb56f/projects/post-message-test)だと、だいたい1ms以内にping pongができているので、少なくとも操作自体は可能
- シークの実用性
  - 未検証。キーフレームの関係による正確性の毀損はありそうだなと踏んでいる


## 親子で必要なメッセージ
### 親 -> 子
- 再生
- 停止
- シーク
- 速度の調整
- ボリューム
  - 縦つまみと横つまみの話はどうするか
  - 一旦縦つまみ対応だけで良い説はある

### 子 -> 親
- ロード状態
- メタデータ
  - タグ、投稿者名、投稿日時、総時間
- 現在の再生箇所
  - 定期的に伝えて、親で修正する感じになる？
- 曲終わりの停止

## 動画リスト・メタデータなど
- 動画IDをキーとする
- 起点タイムスタンプ + BPM をセットで持つ？

## 考えないといけないところ
- BPM / Bar Syncの実装
  - BPMの実装をしてから実験するしかないけど、Syncさせたところで意図したところから再生できるんか？というのはある
  - 仮に難しかったとしたら、キーフレーム位置（というか再生ボタンを押したときに寄せられる箇所）もメタデータとして抱えて、Beat Syncするときは再生を発火したらそこから再生される、を前提に計算してpostMessageする感じになるのかもしれない